---
title: 六：C++内存模型、管理
date: 2024-04-19 00:00:00 +0800
last_modified_at: 2024-04-19 00:00:00 +0800
categories: [cpp, syntax]
tags: [cpp]
author: author1
---

### 前文

本章节说明C++的内存是怎么分配的，有哪些相关名词，代码里怎么操作内存。

### 正文

#### 内存模型

C++程序的内存分为四个部分：
- 代码区：存放函数体的二进制代码，由操作系统进行管理。
- 全局区：存放全局变量、静态变量以及常量区常量。
- 栈：在函数内部声明的所有变量都将占用栈内存。
- 堆：这是程序中未使用的内存，在程序运行时可用于动态分配内存。

对于不同的区域，编译器定的生命周期是不一样的。

**代码区**存放二进制代码，显然需要程序运行完释放，且这个区域只读。

**全局区**就是之前说的存放全局变量还是上一章节中的`static`等，把`static`关键字和内存联系起来就好理解说`static`不改变访问修饰权限了。

**栈**由编译器自动分配释放（这个意思是说主动分配内存是在堆中进行），存放局部变量等，且符合先进后出原则（这也就是为什么函数能递归），如执行函数，到函数体结束时释放内存。

**堆**由编程人员自己分配，如果不进行释放操作，则程序结束系统释放，需要注意内存泄漏。

#### 动态分配内存

首先说明**动态**是什么意思，**动态**的意思是说程序运行时动态加载、释放，相应的，**静态**指编译时就确定的，如全局变量，这个地址编译时就确定了，所以一般不说静态内存管理。

C中用`malloc, calloc, realloc`和`free`，C++中是`new`和`delete`，也就是说C++中用了`new`，请配合使用`delete`。

注意C++中仍保留了`malloc`，但`new`不只是分配了内存，它还创建了对象。
